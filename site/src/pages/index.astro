---
import Layout from '../layouts/Layout.astro';
import { clients } from '../data/clients';
---

<Layout title="ha-mcp Client Configuration">
  <div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- Header -->
    <header class="text-center mb-12">
      <img src="/ha-mcp/logo.png" alt="ha-mcp" class="w-48 mx-auto mb-6" />
      <h1 class="text-4xl font-bold text-white mb-4">
        Configure ha-mcp
      </h1>
      <p class="text-xl text-slate-300 max-w-2xl mx-auto">
        Select your AI assistant to get configuration instructions for the
        <a href="https://github.com/homeassistant-ai/ha-mcp" class="text-blue-400 hover:text-blue-300">Home Assistant MCP Server</a>
      </p>
    </header>

    <!-- Client Grid -->
    <section class="mb-8">
      <h2 class="text-2xl font-semibold text-white mb-6 text-center">Choose Your AI Assistant</h2>
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="client-grid">
        {clients.map((client) => (
          <button
            data-client={client.id}
            class="client-card group relative p-4 rounded-xl border border-slate-700 bg-slate-800/50 hover:bg-slate-700/50 hover:border-blue-500 transition-all duration-200 text-left"
          >
            <div class="flex items-center gap-3 mb-2">
              <div class="w-10 h-10 rounded-lg bg-slate-700 flex items-center justify-center overflow-hidden">
                <img src={client.logo} alt={client.name} class="w-6 h-6" onerror="this.style.display='none'" />
              </div>
              <div>
                <h3 class="font-semibold text-white group-hover:text-blue-400 transition-colors">
                  {client.name}
                </h3>
                <p class="text-xs text-slate-400">{client.company}</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <div class="flex">
                {[1, 2, 3, 4, 5].map((star) => (
                  <svg
                    class={`w-3 h-3 ${star <= client.accuracy ? 'text-yellow-400' : 'text-slate-600'}`}
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                  </svg>
                ))}
              </div>
              <span class="text-xs text-slate-500">{client.accuracy}/5</span>
            </div>
          </button>
        ))}
      </div>
    </section>

    <!-- Configuration Display -->
    <section id="config-section" class="hidden">
      <div class="rounded-2xl border border-slate-700 bg-slate-800/50 overflow-hidden">
        <div class="p-6 border-b border-slate-700">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
              <div id="selected-logo" class="w-12 h-12 rounded-xl bg-slate-700 flex items-center justify-center overflow-hidden">
              </div>
              <div>
                <h2 id="selected-name" class="text-2xl font-bold text-white"></h2>
                <p id="selected-company" class="text-slate-400"></p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <span class="px-3 py-1 rounded-full text-xs font-medium bg-slate-700 text-slate-300" id="selected-format"></span>
              <span class="px-3 py-1 rounded-full text-xs font-medium" id="selected-accuracy"></span>
            </div>
          </div>
        </div>

        <div class="p-6">
          <p id="selected-description" class="text-slate-300 mb-4"></p>

          <div class="mb-4">
            <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">Config Location</h3>
            <code id="selected-location" class="block text-sm text-blue-400 bg-slate-900/50 p-3 rounded-lg whitespace-pre-wrap"></code>
          </div>

          <div class="mb-4">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider">Configuration</h3>
              <button id="copy-btn" class="px-3 py-1 text-sm bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors">
                Copy
              </button>
            </div>
            <pre id="selected-config" class="text-sm bg-slate-900/50 p-4 rounded-lg overflow-x-auto border border-slate-700"><code></code></pre>
          </div>

          <div id="notes-section" class="mb-4">
            <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2">Notes</h3>
            <ul id="selected-notes" class="list-disc list-inside text-slate-300 space-y-1"></ul>
          </div>

          <div id="docs-section" class="hidden">
            <a id="docs-link" href="#" target="_blank" class="inline-flex items-center gap-2 text-blue-400 hover:text-blue-300">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
              </svg>
              View Documentation
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mt-12 text-center text-slate-500 text-sm">
      <p>
        <a href="https://github.com/homeassistant-ai/ha-mcp" class="hover:text-slate-300">GitHub</a>
        ·
        <a href="https://github.com/homeassistant-ai/ha-mcp/issues" class="hover:text-slate-300">Issues</a>
        ·
        Built with
        <a href="https://astro.build" class="hover:text-slate-300">Astro</a>
      </p>
    </footer>
  </div>
</Layout>

<script define:vars={{ clients }}>
  const clientData = clients;

  document.querySelectorAll('.client-card').forEach(card => {
    card.addEventListener('click', () => {
      const clientId = card.dataset.client;
      const client = clientData.find(c => c.id === clientId);
      if (!client) return;

      // Update selected state
      document.querySelectorAll('.client-card').forEach(c => {
        c.classList.remove('ring-2', 'ring-blue-500', 'bg-slate-700/50');
      });
      card.classList.add('ring-2', 'ring-blue-500', 'bg-slate-700/50');

      // Show config section
      document.getElementById('config-section').classList.remove('hidden');

      // Update content
      document.getElementById('selected-logo').innerHTML = `<img src="${client.logo}" alt="${client.name}" class="w-8 h-8" onerror="this.style.display='none'" />`;
      document.getElementById('selected-name').textContent = client.name;
      document.getElementById('selected-company').textContent = client.company;
      document.getElementById('selected-description').textContent = client.description;
      document.getElementById('selected-location').textContent = client.configLocation;
      document.getElementById('selected-config').querySelector('code').textContent = client.config;
      document.getElementById('selected-format').textContent = client.configFormat.toUpperCase();

      // Accuracy badge
      const accuracyEl = document.getElementById('selected-accuracy');
      accuracyEl.textContent = `${client.accuracy}/5 Accuracy`;
      accuracyEl.className = `px-3 py-1 rounded-full text-xs font-medium ${
        client.accuracy >= 4 ? 'bg-green-900 text-green-300' :
        client.accuracy >= 3 ? 'bg-yellow-900 text-yellow-300' :
        'bg-red-900 text-red-300'
      }`;

      // Notes
      const notesList = document.getElementById('selected-notes');
      notesList.innerHTML = client.notes.map(note => `<li>${note}</li>`).join('');

      // Docs link
      const docsSection = document.getElementById('docs-section');
      const docsLink = document.getElementById('docs-link');
      if (client.docsUrl) {
        docsSection.classList.remove('hidden');
        docsLink.href = client.docsUrl;
      } else {
        docsSection.classList.add('hidden');
      }

      // Scroll to config
      document.getElementById('config-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
  });

  // Copy button
  document.getElementById('copy-btn').addEventListener('click', () => {
    const config = document.getElementById('selected-config').querySelector('code').textContent;
    navigator.clipboard.writeText(config);
    const btn = document.getElementById('copy-btn');
    btn.textContent = 'Copied!';
    setTimeout(() => btn.textContent = 'Copy', 2000);
  });
</script>
